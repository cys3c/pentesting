#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import click
import multiprocessing
import re
import requests
import sys

__author__ = '0ren'

PAYLOAD = '<A/iD=xss hREf=javascript&colon;(alert)&lpar;1&rpar; id=xss>nudes</A>'


class CommaSeparatedList(click.ParamType):

    name = 'comma_list'

    def convert(self, value, param, ctx):
        return re.sub(r'\s+', '', value).strip().split(',')


@click.command(context_settings=dict(help_option_names=['-h', '--help']))
@click.option('-v', '--verbose', is_flag=True,
              help='Enable verbose mode.', default=False)
@click.option('-f', '--filename', type=click.Path(exists=True),
              help='Explicit file path containing url(s).')
@click.option('-l', '--list-items', type=CommaSeparatedList(),
              help='Comma separated list containing url(s).')
@click.option('-t', '--threads', default=multiprocessing.cpu_count(),
              help='Number of threads.')
def scan(verbose, filename, list_items, threads):
    """Identify websites vulnerable to XSS via 404 error responses."""
    if len(sys.argv) == 1:
        raise click.UsageError('empty args. Run \'--help\''.format(sys.argv[0]))
    if filename and comma_list:
        raise click.BadOptionUsage('multiple input flags are NOT allowed.')
    if filename:
        with open(filename, 'r') as f:
            for line in f:
                if verbose:
                    print('todo')
    else:
        for item in list_items:
            if verbose:
                print('todo')


if __name__ == '__main__':
    sys.exit(scan())
